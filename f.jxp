<%

var sentFile = false;
var file = null;

if ( request.id )
    file = db._files.findOne( { _id : CrID( request.id ) } );

if ( ! file ){
    response.setResponseCode( 404 );
    return;
}

if ( file.contentType.match( /image/ ) ){
    
    if ( request.maxX || request.maxY ){
	core.media.image();
	var img = new Media.Image( file );
	file = img.scaleToSize( request.maxX , request.maxY );
    }

}
response.setHeader( "X-A1" , file.getClass() );
response.sendFile( file );


%>
