<div id="register">

  <h3>Register</h3>
  
  <form method="post" action="/~~/user/register" onSubmit="return checkRegister( this )" >

    <div>
      <label for="login_user">Username</label>
      <input name="login_user">
    </div>

    <div>
      <label for="login_pass1">Password</label>
      <input type="password" name="login_pass1">
    </div>

    <div>
      <label for="login_pass2">Password Again</label>
      <input type="password" name="login_pass2">
    </div>

    <div>
      <label for="login_email">Email</label>
      <input name="login_email" size=35 >
    </div>

    <input type="submit" value="register">
    
  </form>
  
</div>
<% head.push( "<script src='/~~/ui/js/common.js'></script>" ); %>
<script>
  
  
  function checkRegister( frm ){
    var u = frm.login_user.value;
    var e = frm.login_email.value;

    var p1 = frm.login_pass1.value;
    var p2 = frm.login_pass2.value;

    if ( ! ( u && u.trim().length != 0 ) ){
      window.alert( "need a username" );
      return false;
    }
  
    if ( u.length < 6 ){
      window.alert( "username is too short" );
      return false;
    }
  
    if ( ! ( e && e.trim().length != 0 ) ){
      window.alert( "need an email address" );
      return false;
    }

    if ( ! ( e.length > 4 && e.match( /@/ ) ) ){
      window.alert( "real email address please" );
      return false;
    }
  
    if ( p1 != p2 ){
      window.alert( "passwords don't match" );
      return false;
    } 

    if ( ! ( p1 && p1.trim().length >= 6 ) ){
      window.alert( "password too short" );
      return false;
    }

    var check = loadDocSync( "/~~/user/checkUsername?username=" + u + "&email=" + e );
    if ( ! check.match( /good/ ) ){
      window.alert( "Sorry : " + check );
      return false;
    } 
    
    var u = "/~~/user/register?username=" + u + "&email=" + e + "&password=" + p1;
    location.href = u;
    return false;
  }
</script>
