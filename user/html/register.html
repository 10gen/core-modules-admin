<% processArgs("opts");
   opts = opts || {};
   opts.login = opts.login || "/~~/user";
%>
<div id="register">


  <form method="post" action="<%= opts.login %>/register" onSubmit="return checkRegister( this )" class="edit register">

    <fieldset class="edit register">
    <legend>Register</legend>
    <table>
    <tr>
        <td><label for="login_user">Username</label></td>
        <td><input name="login_user" class="text"></td>
    </tr>

    <tr>
        <td><label for="login_pass1">Password</label></td>
        <td><input type="password" name="login_pass1" class="text"></td>
    </tr>

    <tr>
        <td><label for="login_pass2">Password Again</label></td>
        <td><input type="password" name="login_pass2" class="text"></td>
    </tr>

    <tr>
        <td><label for="login_email">Email</label></td>
        <td><input name="login_email" class="text"></td>
    </tr>

    <% if(User.config.useCaptcha){ %>
    <tr id="comments-open-captcha">
        <td><label>&nbsp;</label></td>
        <td><img src="NOCDN/~~/user/captchaIMG.jxp" id="captcha"/></td>
    </tr>
    
    <tr>
        <td></td>
        <td>
            <span class="small">Type the characters you see in the picture above (just to make sure you&apos;re a human).</span>
            <input name="login_captcha" class="text">
        </td>
    </tr>
    <% } %>

    <tr>
        <td></td>
        <td><input type="submit" value="Register" class="button" style="">
            <% if (opts.to) { %><input type="hidden" name="login_to" value="<%= opts.to %>"/><% } %>
        </td>
    </tr>
    </table>
    </fieldset>
  </form>

</div>
<% head.push( "<script src='/~~/ui/js/common.js'></script>" ); %>
<script>


  function checkRegister( frm ){
    var u = frm.login_user.value;
    var e = frm.login_email.value;

    var p1 = frm.login_pass1.value;
    var p2 = frm.login_pass2.value;

    var c = frm.login_captcha.value;
    if(frm.login_to)
      var to = frm.login_to.value;

    if ( ! ( u && u.trim().length != 0 ) ){
      window.alert( "need a username" );
      return false;
    }

    if ( u.length < 6 ){
      window.alert( "username is too short" );
      return false;
    }

    if ( ! ( e && e.trim().length != 0 ) ){
      window.alert( "need an email address" );
      return false;
    }

    if ( ! ( e.length > 4 && e.match( /@/ ) ) ){
      window.alert( "real email address please" );
      return false;
    }

    if ( p1 != p2 ){
      window.alert( "passwords don't match" );
      return false;
    }

    if ( ! ( p1 && p1.trim().length >= 6 ) ){
      window.alert( "password too short" );
      return false;
    }

    var check = loadDocSync( "<%= opts.login %>/checkUsername?username=" + u + "&email=" + e );
    if ( ! check.match( /good/ ) ){
      window.alert( "Sorry : " + check );
      return false;
    }

    var u = "<%= opts.login %>/register?username=" + u + "&email=" + e + "&password=" + p1 + "&captcha=" + c;
    if(to) u = u + "&to=" + to;
    location.href = u;
    return false;
  }
</script>
